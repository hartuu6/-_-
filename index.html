<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Î∂ÑÏûê Íµ¨ÏÑ± Ïï±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            touch-action: manipulation;
            user-select: none;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f0f4f8;
            color: #333;
            overflow: hidden;
            height: 100vh;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
            position: relative;
        }
        
        .atom-bar {
            background-color: #ffffff;
            padding: 10px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            overflow-x: auto;
            white-space: nowrap;
            -webkit-overflow-scrolling: touch;
            height: 100px;
            display: flex;
            align-items: center;
        }
        
        .atom-bar::-webkit-scrollbar {
            display: none;
        }
        
        .atom {
            display: inline-flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            margin: 0 8px;
            font-weight: bold;
            font-size: 16px;
            cursor: pointer;
            touch-action: none;
            position: relative;
        }
        
        .atom p {
            font-size: 12px;
            margin-top: 2px;
            text-align: center;
        }
        
        .workspace {
            flex: 1;
            position: relative;
            background-color: #f0f4f8;
            overflow: hidden;
            touch-action: none;
        }
        
        .workspace-atom {
            position: absolute;
            display: flex;
            justify-content: center;
            align-items: center;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            font-weight: bold;
            cursor: pointer;
            touch-action: none;
            z-index: 10;
        }
        
        .bond {
            position: absolute;
            background-color: #555;
            height: 5px;
            transform-origin: left center;
            z-index: 1;
        }
        
        .info-panel {
            position: absolute;
            top: 110px;
            right: 0;
            width: 120px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 10px 0 0 10px;
            padding: 15px;
            box-shadow: -2px 2px 10px rgba(0,0,0,0.1);
            z-index: 100;
        }
        
        .info-panel h3 {
            margin-bottom: 10px;
            font-size: 14px;
        }
        
        .info-item {
            margin-bottom: 15px;
        }
        
        .info-item label {
            display: block;
            margin-bottom: 5px;
            font-size: 12px;
        }
        
        .info-item input {
            width: 100%;
            padding: 6px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 12px;
        }
        
        .formula {
            font-weight: bold;
            margin-top: 10px;
            word-break: break-all;
            font-size: 12px;
        }
        
        .trash {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background-color: rgba(255, 0, 0, 0.1);
            border: 2px dashed #ff6b6b;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #ff6b6b;
            font-size: 24px;
            z-index: 100;
        }
        
        .trash.active {
            background-color: rgba(255, 0, 0, 0.3);
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="atom-bar" id="atomBar">
            <!-- ÏõêÏûêÎì§ÏùÄ ÏûêÎ∞îÏä§ÌÅ¨Î¶ΩÌä∏Î°ú ÎèôÏ†Å ÏÉùÏÑ± -->
        </div>
        
        <div class="workspace" id="workspace">
            <!-- ÎìúÎûòÍ∑∏Îêú ÏõêÏûêÎì§Ïù¥ ÏúÑÏπòÌï† ÏòÅÏó≠ -->
        </div>
        
        <div class="info-panel">
            <h3>Î∂ÑÏûê Ï†ïÎ≥¥</h3>
            <div class="info-item">
                <label for="molWeight">ÌôîÌïôÏãùÎüâ:</label>
                <div id="molWeight">0 g/mol</div>
            </div>
            <div class="info-item">
                <label for="molInput">Î™∞ Ïàò:</label>
                <input type="number" id="molInput" value="1" min="0.001" step="0.001">
            </div>
            <div class="info-item">
                <label for="totalWeight">Ï¥ù ÏßàÎüâ:</label>
                <div id="totalWeight">0 g</div>
            </div>
            <div class="formula" id="formula"></div>
        </div>
        
        <div class="trash" id="trash">
            <span>üóëÔ∏è</span>
        </div>
    </div>
    
    <script>
        // ÏõêÏûê Îç∞Ïù¥ÌÑ∞ (ÏõêÏÜå Í∏∞Ìò∏, Ïù¥Î¶Ñ, ÏõêÏûêÎüâ, ÏÉâÏÉÅ)
        const atoms = [
            { symbol: 'H', name: 'ÏàòÏÜå', mass: 1.008, color: '#CCCCCC' },
            { symbol: 'He', name: 'Ìó¨Î•®', mass: 4.003, color: '#D9FFFF' },
            { symbol: 'Li', name: 'Î¶¨Ìä¨', mass: 6.941, color: '#CC80FF' },
            { symbol: 'Be', name: 'Î≤†Î¶¥Î•®', mass: 9.012, color: '#C2FF00' },
            { symbol: 'B', name: 'Î∂ïÏÜå', mass: 10.811, color: '#FFB5B5' },
            { symbol: 'C', name: 'ÌÉÑÏÜå', mass: 12.011, color: '#909090' },
            { symbol: 'N', name: 'ÏßàÏÜå', mass: 14.007, color: '#3050F8' },
            { symbol: 'O', name: 'ÏÇ∞ÏÜå', mass: 15.999, color: '#FF0D0D' },
            { symbol: 'F', name: 'ÌîåÎ£®Ïò§Î¶∞', mass: 18.998, color: '#90E050' },
            { symbol: 'Ne', name: 'ÎÑ§Ïò®', mass: 20.180, color: '#B3E3F5' },
            { symbol: 'Na', name: 'ÎÇòÌä∏Î•®', mass: 22.990, color: '#AB5CF2' },
            { symbol: 'Mg', name: 'ÎßàÍ∑∏ÎÑ§Ïäò', mass: 24.305, color: '#8AFF00' },
            { symbol: 'Al', name: 'ÏïåÎ£®ÎØ∏ÎäÑ', mass: 26.982, color: '#BFA6A6' },
            { symbol: 'Si', name: 'Í∑úÏÜå', mass: 28.086, color: '#F0C8A0' },
            { symbol: 'P', name: 'Ïù∏', mass: 30.974, color: '#FF8000' },
            { symbol: 'S', name: 'Ìô©', mass: 32.065, color: '#FFFF30' },
            { symbol: 'Cl', name: 'ÏóºÏÜå', mass: 35.453, color: '#1FF01F' },
            { symbol: 'Ar', name: 'ÏïÑÎ•¥Í≥§', mass: 39.948, color: '#80D1E3' },
            { symbol: 'K', name: 'ÏπºÎ•®', mass: 39.098, color: '#8F40D4' },
            { symbol: 'Ca', name: 'ÏπºÏäò', mass: 40.078, color: '#3DFF00' },
            { symbol: 'Fe', name: 'Ï≤†', mass: 55.845, color: '#E06633' },
            { symbol: 'Cu', name: 'Íµ¨Î¶¨', mass: 63.546, color: '#C88033' },
            { symbol: 'Zn', name: 'ÏïÑÏó∞', mass: 65.38, color: '#7D80B0' },
            { symbol: 'Ag', name: 'ÏùÄ', mass: 107.868, color: '#C0C0C0' },
            { symbol: 'Au', name: 'Í∏à', mass: 196.967, color: '#FFD123' },
            { symbol: 'Hg', name: 'ÏàòÏùÄ', mass: 200.59, color: '#B8B8D0' },
            { symbol: 'Pb', name: 'ÎÇ©', mass: 207.2, color: '#575961' }
        ];
        
        // ÌòÑÏû¨ Î∂ÑÏûêÎ•º Íµ¨ÏÑ±ÌïòÎäî ÏõêÏûêÎì§
        let workspaceAtoms = [];
        // ÏõêÏûêÎì§ ÏÇ¨Ïù¥Ïùò Í≤∞Ìï©
        let bonds = [];
        
        document.addEventListener('DOMContentLoaded', function() {
            const atomBar = document.getElementById('atomBar');
            const workspace = document.getElementById('workspace');
            const molWeight = document.getElementById('molWeight');
            const molInput = document.getElementById('molInput');
            const totalWeight = document.getElementById('totalWeight');
            const formula = document.getElementById('formula');
            const trash = document.getElementById('trash');
            
            // ÏõêÏûê Î∞îÏóê ÏõêÏûê Ï∂îÍ∞Ä
            atoms.forEach(atom => {
                const atomElem = document.createElement('div');
                atomElem.className = 'atom';
                atomElem.style.backgroundColor = atom.color;
                atomElem.innerHTML = `<div>${atom.symbol}<p>${atom.name}</p></div>`;
                atomElem.dataset.symbol = atom.symbol;
                atomElem.dataset.mass = atom.mass;
                atomElem.dataset.color = atom.color;
                
                // ÌÑ∞Ïπò Ïù¥Î≤§Ìä∏Î°ú ÎìúÎûòÍ∑∏ ÏãúÏûë
                atomElem.addEventListener('touchstart', startDragFromBar);
                
                atomBar.appendChild(atomElem);
            });
            
            // Î™∞ Ïàò Î≥ÄÍ≤Ω Ïù¥Î≤§Ìä∏
            molInput.addEventListener('input', updateTotalWeight);
            
            // ÎìúÎûòÍ∑∏ ÏãúÏûë (ÏõêÏûê Î∞îÏóêÏÑú)
            function startDragFromBar(e) {
                e.preventDefault();
                
                const touch = e.touches[0];
                const atomElem = e.currentTarget;
                const atom = {
                    symbol: atomElem.dataset.symbol,
                    mass: parseFloat(atomElem.dataset.mass),
                    color: atomElem.dataset.color
                };
                
                // ÏÉà ÏõêÏûê ÏÉùÏÑ±ÌïòÏó¨ ÏõåÌÅ¨Ïä§ÌéòÏù¥Ïä§Ïóê Ï∂îÍ∞Ä
                const newAtom = document.createElement('div');
                newAtom.className = 'workspace-atom';
                newAtom.style.backgroundColor = atom.color;
                newAtom.textContent = atom.symbol;
                newAtom.dataset.symbol = atom.symbol;
                newAtom.dataset.mass = atom.mass;
                newAtom.dataset.color = atom.color;
                newAtom.dataset.id = Date.now(); // Í≥†Ïú† ID Î∂ÄÏó¨
                
                // ÏõêÏûê ÏúÑÏπò ÏÑ§Ï†ï
                const rect = workspace.getBoundingClientRect();
                const x = touch.clientX - rect.left - 25; // Ï§ëÏïôÏóê ÏúÑÏπò
                const y = touch.clientY - rect.top - 25;
                
                newAtom.style.left = `${x}px`;
                newAtom.style.top = `${y}px`;
                workspace.appendChild(newAtom);
                
                // ÏõåÌÅ¨Ïä§ÌéòÏù¥Ïä§ ÏõêÏûê Î∞∞Ïó¥Ïóê Ï∂îÍ∞Ä
                workspaceAtoms.push({
                    id: newAtom.dataset.id,
                    symbol: atom.symbol,
                    mass: atom.mass,
                    element: newAtom,
                    x: x + 25, // Ï§ëÏã¨Ï†ê Ï¢åÌëú
                    y: y + 25
                });
                
                // ÏÉà ÏõêÏûêÏóê ÎåÄÌïú Ïù¥Î≤§Ìä∏ Î¶¨Ïä§ÎÑà ÏÑ§Ï†ï
                newAtom.addEventListener('touchstart', startDragInWorkspace);
                
                // ÎìúÎûòÍ∑∏ ÏãúÏûë
                moveAtom(e, newAtom);
                updateMoleculeInfo();
            }
            
            // ÏõåÌÅ¨Ïä§ÌéòÏù¥Ïä§ ÎÇ¥ÏóêÏÑú ÎìúÎûòÍ∑∏ ÏãúÏûë
            function startDragInWorkspace(e) {
                e.preventDefault();
                e.stopPropagation();
                
                const atom = e.currentTarget;
                moveAtom(e, atom);
            }
            
            // ÏõêÏûê Ïù¥Îèô Ìï®Ïàò
            function moveAtom(startEvent, atom) {
                const rect = workspace.getBoundingClientRect();
                const atomRect = atom.getBoundingClientRect();
                const atomRadius = atomRect.width / 2;
                
                // Ï¥àÍ∏∞ ÌÑ∞Ïπò ÏúÑÏπòÏôÄ ÏõêÏûê ÏúÑÏπò Ï∞®Ïù¥ Í≥ÑÏÇ∞
                const touch = startEvent.touches[0];
                const offsetX = touch.clientX - atomRect.left - atomRadius;
                const offsetY = touch.clientY - atomRect.top - atomRadius;
                
                // ÎìúÎûòÍ∑∏ Ï§ë
                function onTouchMove(e) {
                    const touch = e.touches[0];
                    
                    // ÏÉà ÏúÑÏπò Í≥ÑÏÇ∞
                    let x = touch.clientX - rect.left - offsetX - atomRadius;
                    let y = touch.clientY - rect.top - offsetY - atomRadius;
                    
                    // Í≤ΩÍ≥Ñ ÎÇ¥Ïóê ÏûàÎèÑÎ°ù Ï†úÌïú
                    x = Math.max(0, Math.min(rect.width - atomRect.width, x));
                    y = Math.max(0, Math.min(rect.height - atomRect.height, y));
                    
                    // ÏõêÏûê ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏
                    atom.style.left = `${x}px`;
                    atom.style.top = `${y}px`;
                    
                    // ÏõåÌÅ¨Ïä§ÌéòÏù¥Ïä§ ÏõêÏûê Î∞∞Ïó¥ÏóêÏÑú ÏúÑÏπò ÏóÖÎç∞Ïù¥Ìä∏
                    const atomObj = workspaceAtoms.find(a => a.id === atom.dataset.id);
                    if (atomObj) {
                        atomObj.x = x + atomRadius;
                        atomObj.y = y + atomRadius;
                    }
                    
                    // Ïì∞Î†àÍ∏∞ÌÜµ ÌôúÏÑ±Ìôî ÌôïÏù∏
                    const trashRect = trash.getBoundingClientRect();
                    if (
                        touch.clientX >= trashRect.left &&
                        touch.clientX <= trashRect.right &&
                        touch.clientY >= trashRect.top &&
                        touch.clientY <= trashRect.bottom
                    ) {
                        trash.classList.add('active');
                    } else {
                        trash.classList.remove('active');
                    }
                    
                    // Îã§Î•∏ ÏõêÏûêÏôÄÏùò Í±∞Î¶¨ ÌôïÏù∏ÌïòÏó¨ Í≤∞Ìï© ÏÉùÏÑ±
                    updateBonds();
                }
                
                // ÎìúÎûòÍ∑∏ Ï¢ÖÎ£å
                function onTouchEnd(e) {
                    // Ïì∞Î†àÍ∏∞ÌÜµÏóê ÏûàÎäîÏßÄ ÌôïÏù∏
                    const touch = e.changedTouches[0];
                    const trashRect = trash.getBoundingClientRect();
                    
                    if (
                        touch.clientX >= trashRect.left &&
                        touch.clientX <= trashRect.right &&
                        touch.clientY >= trashRect.top &&
                        touch.clientY <= trashRect.bottom
                    ) {
                        // ÏõêÏûê Ï†úÍ±∞
                        workspace.removeChild(atom);
                        
                        // Í¥ÄÎ†® Í≤∞Ìï© Ï†úÍ±∞
                        const relatedBonds = bonds.filter(bond => 
                            bond.atom1.id === atom.dataset.id || 
                            bond.atom2.id === atom.dataset.id
                        );
                        
                        relatedBonds.forEach(bond => {
                            if (bond.element && bond.element.parentNode) {
                                workspace.removeChild(bond.element);
                            }
                        });
                        
                        // Î∞∞Ïó¥ÏóêÏÑú Ï†úÍ±∞
                        bonds = bonds.filter(bond => 
                            bond.atom1.id !== atom.dataset.id && 
                            bond.atom2.id !== atom.dataset.id
                        );
                        
                        workspaceAtoms = workspaceAtoms.filter(a => a.id !== atom.dataset.id);
                        
                        trash.classList.remove('active');
                    }
                    
                    document.removeEventListener('touchmove', onTouchMove);
                    document.removeEventListener('touchend', onTouchEnd);
                    
                    updateMoleculeInfo();
                }
                
                document.addEventListener('touchmove', onTouchMove, { passive: false });
                document.addEventListener('touchend', onTouchEnd);
            }
            
            // Í≤∞Ìï© ÏóÖÎç∞Ïù¥Ìä∏
            function updateBonds() {
                // Í∏∞Ï°¥ Í≤∞Ìï© ÏöîÏÜå Ï†úÍ±∞
                bonds.forEach(bond => {
                    if (bond.element && bond.element.parentNode) {
                        workspace.removeChild(bond.element);
                    }
                });
                
                // Í≤∞Ìï© Î∞∞Ïó¥ Ï¥àÍ∏∞Ìôî
                bonds = [];
                
                // Î™®Îì† ÏõêÏûê ÏåçÏùÑ Ï≤¥ÌÅ¨ÌïòÏó¨ Í≤∞Ìï© ÏÉùÏÑ±
                for (let i = 0; i < workspaceAtoms.length; i++) {
                    for (let j = i + 1; j < workspaceAtoms.length; j++) {
                        const atom1 = workspaceAtoms[i];
                        const atom2 = workspaceAtoms[j];
                        
                        // Îëê ÏõêÏûê ÏÇ¨Ïù¥Ïùò Í±∞Î¶¨ Í≥ÑÏÇ∞
                        const dx = atom2.x - atom1.x;
                        const dy = atom2.y - atom1.y;
                        const distance = Math.sqrt(dx * dx + dy * dy);
                        
                        // Í±∞Î¶¨Í∞Ä 60px Ïù¥ÌïòÎ©¥ Í≤∞Ìï© ÏÉùÏÑ±
                        if (distance <= 60) {
                            // Í≤∞Ìï© ÏöîÏÜå ÏÉùÏÑ±
                            const bondElem = document.createElement('div');
                            bondElem.className = 'bond';
                            
                            // Í≤∞Ìï© ÏúÑÏπò Î∞è Í∏∏Ïù¥ ÏÑ§Ï†ï
                            bondElem.style.left = `${atom1.x}px`;
                            bondElem.style.top = `${atom1.y}px`;
                            bondElem.style.width = `${distance}px`;
                            
                            // Í≤∞Ìï© Í∞ÅÎèÑ Í≥ÑÏÇ∞
                            const angle = Math.atan2(dy, dx) * (180 / Math.PI);
                            bondElem.style.transform = `rotate(${angle}deg)`;
                            
                            workspace.appendChild(bondElem);
                            
                            // Í≤∞Ìï© Ï†ïÎ≥¥ Ï†ÄÏû•
                            bonds.push({
                                atom1: atom1,
                                atom2: atom2,
                                element: bondElem
                            });
                        }
                    }
                }
            }
            
            // Î∂ÑÏûê Ï†ïÎ≥¥ ÏóÖÎç∞Ïù¥Ìä∏
            function updateMoleculeInfo() {
                // Í∞Å ÏõêÏÜåÎ≥Ñ Í∞úÏàò Í≥ÑÏÇ∞
                const elementCounts = {};
                workspaceAtoms.forEach(atom => {
                    if (elementCounts[atom.symbol]) {
                        elementCounts[atom.symbol]++;
                    } else {
                        elementCounts[atom.symbol] = 1;
                    }
                });
                
                // ÌôîÌïôÏãù ÏÉùÏÑ±
                let formulaText = '';
                // ÏõêÏÜåÎ•º Í∏∞Ìò∏ ÏàúÏúºÎ°ú Ï†ïÎ†¨ÌïòÎêò, CÏôÄ HÎ•º Î®ºÏ†Ä ÌëúÏãú
                const sortedElements = Object.keys(elementCounts).sort((a, b) => {
                    if (a === 'C') return -1;
                    if (b === 'C') return 1;
                    if (a === 'H') return -1;
                    if (b === 'H') return 1;
                    return a.localeCompare(b);
                });
                
                sortedElements.forEach(element => {
                    formulaText += element;
                    if (elementCounts[element] > 1) {
                        formulaText += `<sub>${elementCounts[element]}</sub>`;
                    }
                });
                
                // Î∂ÑÏûêÎüâ Í≥ÑÏÇ∞
                let totalMass = 0;
                workspaceAtoms.forEach(atom => {
                    totalMass += atom.mass;
                });
                
                // ÌôîÎ©¥ ÏóÖÎç∞Ïù¥Ìä∏
                molWeight.textContent = `${totalMass.toFixed(3)} g/mol`;
                formula.innerHTML = formulaText;
                
                updateTotalWeight();
            }
            
            // Ï¥ù ÏßàÎüâ ÏóÖÎç∞Ïù¥Ìä∏
            function updateTotalWeight() {
                const moles = parseFloat(molInput.value) || 0;
                const mass = parseFloat(molWeight.textContent) || 0;
                const total = moles * mass;
                
                totalWeight.textContent = `${total.toFixed(3)} g`;
            }
        });
    </script>
</body>
</html>
